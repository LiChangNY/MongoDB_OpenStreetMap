{
  "name": "OpenStreetMap Data Exploration",
  "tagline": "Cleaned and transformed large OpenStreetMap dataset to JSON file; Used MongoDB and MapReduce framework to analyze user contributions and geo-information of Ho Chi Minh City.",
  "body": "# Data Wrangling with OpenStreetMap\r\n\r\n* [exercise](https://github.com/LiChangNY/Udacity_MongoDB/tree/master/exercise): scripts for lesson 6 exercises\r\n* [data](https://github.com/LiChangNY/Udacity_MongoDB/tree/master/data): original OpenStreetMap dataset and converted JSON file\r\n* [report](https://github.com/LiChangNY/Udacity_MongoDB/tree/master/index.html): project summary HTML file\r\n* [script](https://github.com/LiChangNY/Udacity_MongoDB/tree/master/script): scripts for data cleaning and MongoDB analysis\r\n* [reference](https://github.com/LiChangNY/Udacity_MongoDB/tree/master/reference): resources used for this project\r\n\r\n##Ho Chi Minh City\r\nThe reason why I choose Ho Chi Minh City is because it's one of my choices for destination wedding. I want to use OpenStreetMap to explore what hotels are available in the area and, if possible, to compare amenities and ratings of different hotels. Here are the general steps for preparing the dataset:\r\n1. Download data from MapZen:\r\nhttps://s3.amazonaws.com/metro-extracts.mapzen.com/ho-chi-minh-city_vietnam.osm.bz2 It returns a file of 64 MB (uncompressed).\r\n2. Clean, convert XML data to JSON format using \"data_clean.py\"\r\n3. Load JSON file to MongoDB for analysis.\r\nmongoimport –d test –c ho ho-chi-minh-city_vietnam.osm.json\r\n \r\n##Problems encountered\r\n1. Missing addresses\r\nWhen I was looking at some XML data, I found many records are missing or have incomplete addresses. After I loaded JSON file to MongoDB, it shows that the majorities, 332,214 records, don't have the address information at all.\r\n```\r\n> db.ho.find( { address: {$exists: false}}).count()\r\n332214.\r\n```\r\n\r\n2. Street mixed with other address information\r\nI also found that some streets were mixed with district or even city information. For example: \r\n```\r\n\"street\" : \"Dương B� Trạc, Phường 2, Quận 8, Tp. Hồ Ch� Minh\"  <br />\r\n\"street\" : \"Pham Ngu Lao, District 1\"  <br />\r\n\"street\" : \"Dương B� Trạc, Phường 2, Quận 8, Tp. Hồ Ch� Minh\"  <br />\r\n```\r\n\r\nSo during the data cleaning process, I decided to keep strings before the first coma even though I lost other information.  Here are the top street names.\r\n\r\n```\r\n> db.ho.aggregate( [ {$match: {\"address.street\": {$exists: true}}}, {$group: { _id: \"$address.street\", total: { $sum: 1}}}, { $sort: {total: -1}},  {$limit: 5} ])\r\n{ \"_id\" : \"V� Văn Ng�n\", \"total\" : 56 } \r\n{ \"_id\" : \"Trường Chinh\", \"total\" : 34 }  \r\n{ \"_id\" : \"Nguyễn Thị Minh Khai\", \"total\" : 24 }\r\n{ \"_id\" : \"Hai B� Trưng\", \"total\" : 19 } \r\n{ \"_id\" : \"Đ�o Duy Anh\", \"total\" : 18 }\r\n```\r\n\r\nI've never been to Vietnam so I am interested in knowing what type of street names have been used in Vietnam: I first used MongoDB's MapReduce framework to parse out, aggregate individual words, then list the most used words and finally compared the results with common street names and abbreviations in Vietnam.  Interestingly, very limited street names such as \"Đường\" (Road, Street, Drive) appeared on the top list; the majority belongs to people's names since many streets, especially in the south, are named to honor communist heroes or folklore characters. \r\n\r\n##MapReduce\r\n```\r\n> var map = function() { if(this.address != null && this.address.street != null) { var words = this.address.street.split(\" \"); if(words == null){return;} for (var i = 0; i < words.length; i ++ ){ emit(words[i], {count: 1});}}}\r\n> var reduce = function(key, values) {var total = 0; for (var i =0; i < values.length; i ++) { if(values[i] != null) total += values[i].count;} return {count: total};}\r\n> var final = function(key, values) {return key, values;}\r\n> db.ho.mapReduce(map, reduce, {out:\"results\", finalize: final})  \r\n\r\n{\r\n     \"result\" : \"results\",\r\n     \"timeMillis\" : 3883,\r\n     \"counts\" : {\r\n         \"input\" : 333369,\r\n         \"emit\" : 2518,\r\n         \"reduce\" : 268,\r\n         \"output\" : 409\r\n     },\r\n     \"ok\" : 1\r\n}\r\n```\r\n\r\n```\r\n> db.results.aggregate( {$sort: {\"value.count\": -1}}, {$limit:10})\r\n{ \"_id\" : \"Nguyễn\", \"value\" : { \"count\" : 165 } }\r\n{ \"_id\" : \"Văn\", \"value\" : { \"count\" : 129 } }\r\n{ \"_id\" : \"V�\", \"value\" : { \"count\" : 71 } }\r\n{ \"_id\" : \"Ng�n\", \"value\" : { \"count\" : 56 } }\r\n{ \"_id\" : \"L�\", \"value\" : { \"count\" : 51 } }\r\n{ \"_id\" : \"Đường\", \"value\" : { \"count\" : 41 } }\r\n{ \"_id\" : \"Thị\", \"value\" : { \"count\" : 40 } }\r\n{ \"_id\" : \"Trường\", \"value\" : { \"count\" : 38 } }\r\n{ \"_id\" : \"Chinh\", \"value\" : { \"count\" : 36 } }\r\n{ \"_id\" : \"Minh\", \"value\" : { \"count\" : 35 } }\r\n```\r\n3. Missing/inaccurate postcodes\r\nI also took a look at the postcodes that should have at least 5 digits starting with either 70 or 76. However, as you can see from below, many have strings instead of numbers.\r\n```\r\n> db.ho.aggregate( [ {$match: {\"address.postcode\": {$exists: true}}}, {$group: { _id: \"$address.postcode\", total: { $sum: 1}}}, { $sort: {total: -1}},  {$limit: 5} ])\r\n{ \"_id\" : \"Quan Thu Duc\", \"total\" : 84 }\r\n{ \"_id\" : \"70000\", \"total\" : 13 }\r\n{ \"_id\" : \"7000\", \"total\" : 4 }\r\n{ \"_id\" : \"08\", \"total\" : 1 }\r\n{ \"_id\" : \"District 3\", \"total\" : 1 }\r\n```\r\nTherefore I cleaned up inaccurate postcodes before exporting to JSON file and it turns out only 21 records have valid postcodes.\r\n```\r\n> db.ho.aggregate( [ {$match: {\"address.postcode\": {$exists: true}}}, {$group: { _id: \"$address.postcode\", total: { $sum: 1}}}, { $sort: {total: -1}},  {$limit: 10} ])\r\n{ \"_id\" : \"70000\", \"total\" : 13 }\r\n{ \"_id\" : \"7000\", \"total\" : 4 }\r\n{ \"_id\" : \"70000-989\", \"total\" : 1 }\r\n{ \"_id\" : \"709999\", \"total\" : 1 }\r\n{ \"_id\" : \"70000-1648\", \"total\" : 1 }\r\n{ \"_id\" : \"70150\", \"total\" : 1 }\r\n```\r\n\r\n##Overview of the data\r\nThe imported JSON file has about 91 MB and a total of 333,369 records comprised of 299,969 nodes and 33,400 ways.\r\n```\r\n> db.ho.stats()\r\n{\r\n     \"ns\" : \"test.ho\",\r\n     \"count\" : 333369,\r\n     \"size\" : 95796592,\r\n     \"avgObjSize\" : 287,\r\n     \"storageSize\" : 123936768,\r\n     \"numExtents\" : 11,\r\n     \"nindexes\" : 1,\r\n     \"lastExtentSize\" : 37625856,\r\n     \"paddingFactor\" : 1,\r\n     \"systemFlags\" : 1,\r\n     \"userFlags\" : 1,\r\n     \"totalIndexSize\" : 10833200,\r\n     \"indexSizes\" : {\r\n         \"_id_\" : 10833200\r\n     },\r\n     \"ok\" : 1\r\n}\r\n\r\n> db.ho.find( {type: 'node'}).count()\r\n299969\r\n> db.ho.find( {type: 'way'}).count()\r\n33400\r\n```\r\n\r\nA total of 329 users have been contributing to this area.\r\n```\r\n> db.ho.distinct('created.user').length\r\n329\r\n```\r\n \r\nTop 10 users contributed about 90% of the total records. Kudos to those diligent folks!\r\n```\r\n> db.ho.aggregate( { $group: { _id: \"$created.user\", total: { $sum: 1}}}, { $sort: {total: -1}},  { $limit: 10} )\r\n{ \"_id\" : \"Tuan Ifan Vpy\", \"total\" : 89563 }\r\n{ \"_id\" : \"Ivan Garcia\", \"total\" : 84724 }\r\n{ \"_id\" : \"Dymo12\", \"total\" : 42389 }\r\n{ \"_id\" : \"QuangDBui@TMA\", \"total\" : 32285 }\r\n{ \"_id\" : \"528491\", \"total\" : 16985 }\r\n{ \"_id\" : \"guenter\", \"total\" : 10841 }\r\n{ \"_id\" : \"tandung\", \"total\" : 9709 }\r\n{ \"_id\" : \"ZeitgeistGroup\", \"total\" : 5772 }\r\n{ \"_id\" : \"ninomax\", \"total\" : 5396 }\r\n{ \"_id\" : \"jaapsen\", \"total\" : 3842 }\r\n```\r\n\r\nInterestingly, the top one amenity is fuel station. It actually makes sense given that Ho Chi Minh is a city on the motorbikes and scooters!\r\n```\r\n> db.ho.aggregate( [ {$match: {amenity: {$exists: true}}}, {$group: { _id: \"$amenity\", \"total\": { $sum: 1}}}, { $sort: { total: -1}}, { $limit: 10}])\r\n\r\n{ \"_id\" : \"fuel\", \"total\" : 483 }\r\n{ \"_id\" : \"atm\", \"total\" : 268 }\r\n{ \"_id\" : \"school\", \"total\" : 253 }\r\n{ \"_id\" : \"restaurant\", \"total\" : 218 }\r\n{ \"_id\" : \"cafe\", \"total\" : 216 }\r\n{ \"_id\" : \"place_of_worship\", \"total\" : 189 }\r\n{ \"_id\" : \"bank\", \"total\" : 149 }\r\n{ \"_id\" : \"fast_food\", \"total\" : 131 }\r\n{ \"_id\" : \"parking\", \"total\" : 112 }\r\n{ \"_id\" : \"hospital\", \"total\" : 71 }\r\n```\r\n\r\n##Other ideas about the datasets\r\nFor my purpose, I want to look at what hotels are available in Ho Chi Minh City. There are 142 records matching exiting tags for hotel.\r\n```\r\n> db.ho.find( {$or: [ { tourism: 'hotel'}, {building: 'hotel'}]}).count()\r\n142\r\n```\r\n \r\nOf 7 hotels that have ratings, 4 hotels are rated five-star and 3 are three-star.\r\n```\r\n> db.ho.aggregate({$match: { $or: [{tourism: 'hotel'}, {building: 'hotel'}]}},{$group: { _id: \"$stars\", total: {$sum: 1}}},{ $sort: {_id: -1}})\r\n\r\n{ \"_id\" : \"5\", \"total\" : 4 }\r\n{ \"_id\" : \"3\", \"total\" : 3 }\r\n{ \"_id\" : null, \"total\" : 135 }\r\n```\r\n\r\nHere are the five-star hotels:\r\n```\r\n> db.ho.aggregate({$match: {stars: \"5\"}},{$group: { _id: \"$name\", total: {$sum: 1}}},{ $sort: {_id: -1}})\r\n{ \"_id\" : \"Park Hyatt\", \"total\" : 1 }\r\n{ \"_id\" : \"Nikko Saigon\", \"total\" : 1 }\r\n{ \"_id\" : \"M�venpick Hotel Saigon\", \"total\" : 1 }\r\n{ \"_id\" : \"Majestic Hotel\", \"total\" : 1 }\r\n```\r\n\r\nOnly one hotel has information on number of rooms.\r\n```\r\n> db.ho.aggregate({$match: { $or: [{tourism: 'hotel'}, {building: 'hotel'}]}},{$group: { _id: \"$rooms\", total: {$sum: 1}}},{ $sort: {_id: -1}})\r\n{ \"_id\" : \"247\", \"total\" : 1 }\r\n{ \"_id\" : null, \"total\" : 141 }\r\n```\r\n\r\nAs discussed in the Problems Encountered section, missing information on addresses (and hotel information discussed in this section) is a big problem for this OSM dataset. To tackle such large number of missing data, I don�t think it is realistic to rely on individual users to insert information. Instead, leveraging an online survey may be a feasible solution and starting point. This survey can include basic fields such as street name, house number, and key information pursuant to specific business such as the rating for hotel, etc. However, distributing the survey to individual business owners/points of contact may be challenging. One idea is to reach out to the local associations, for example, the Vietnam National Administration of Tourism located in Ho Chi Minh City, because these associations typically maintain good contacts with local businesses and can help administrate the process, increase survey response rate, and monitor the quality of data collected as long as they can be convinced that populating information on OpenStreetMap can help the public retrieve information and promote local tourism. After collecting survey data, we can batch upload the information to OpenStreetMap.\r\n \r\n \r\n##Conclusion\r\nAfter using Python and MongoDB to examine the OpenStreetMap data, I realized that there is still much work needed to fill in the address information. Exploring a dataset in non-English language is certainly challenging for me. But throughout the research, I certainly learned quite a bit about Vietnamese culture like street naming convention. Also, I was able to find a few good leads as potential wedding venue. However, if the dataset can have more information on the ratings and address, I am sure it can expand my search results and help me find the ideal hotel.\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}